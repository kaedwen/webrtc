{"version":3,"file":"main.js","mappings":";;;;;;;;;;;;;;;;;;;AAA2G;AACvC;AACA;;;;AAQ9D,MAAOG,YAAY;EAUjBC,OAAO,CAACC,CAAgB;IAAA;IAAA;MAC5B,IAAI,CAAC,KAAI,CAACC,gBAAgB,EAAE;QAC1B,MAAM,KAAI,CAACC,UAAU,EAAE;;MAGzB,KAAK,MAAMC,EAAE,IAAI,KAAI,CAACC,SAAS,EAAE;QAC/BD,EAAE,CAACE,QAAQ,CAACC,UAAU,EAAE;;IACzB;EACH;EAEcJ,UAAU;IAAA;IAAA;MACtB,MAAMK,MAAM,SAASC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;QACvDC,KAAK,EAAE,IAAI;QACXC,KAAK,EAAE;OACR,CAAC;MAEF,MAAI,CAACC,EAAE,CAACC,QAAQ,CAACP,MAAM,CAACQ,cAAc,EAAE,CAAC,CAAC,CAAC,CAAC;MAE5C,MAAI,CAACd,gBAAgB,GAAG,IAAI;IAAC;EAC/B;EAEAe,YAAoBC,SAA2B;IAAA;IAA3B,cAAS,GAATA,SAAS;IA3BrB,cAAS,GAAmC,EAAE;IAC9C,qBAAgB,GAAG,KAAK;IA2B9B;IACA,IAAI,CAACJ,EAAE,GAAG,IAAIK,iBAAiB,EAAE;IAEjC;IACA,IAAI,CAACL,EAAE,CAACM,OAAO,GAAIC,KAAK,IAAI;MAC1B,MAAM,CAACC,YAAY,CAAC,GAAGD,KAAK,CAACE,OAAO;MACpC,IAAIF,KAAK,CAACG,KAAK,CAACC,IAAI,KAAK,OAAO,EAAE;QAChC,MAAMZ,KAAK,GAAG,IAAI,CAACa,GAAG,CAACC,eAAe,CAAC9B,6EAAc,EAAE,EAAE,CAAC;QAC1DgB,KAAK,CAACP,QAAQ,CAACsB,SAAS,CAACN,YAAY,CAAC;QACtCT,KAAK,CAACP,QAAQ,CAACuB,IAAI,EAAE;QACrBC,OAAO,CAACC,GAAG,CAAClB,KAAK,CAAC;OACnB,MAAM,IAAIQ,KAAK,CAACG,KAAK,CAACC,IAAI,KAAK,OAAO,EAAE;QACvC,MAAMb,KAAK,GAAG,IAAI,CAACc,GAAG,CAACC,eAAe,CAAC7B,6EAAc,EAAE,EAAE,CAAC;QAC1Dc,KAAK,CAACN,QAAQ,CAACsB,SAAS,CAACN,YAAY,CAAC;QACtCQ,OAAO,CAACC,GAAG,CAACnB,KAAK,CAAC;QAElB,IAAI,CAACP,SAAS,CAAC2B,IAAI,CAACpB,KAAK,CAAC;;IAE9B,CAAC;IAED,IAAI,CAACE,EAAE,CAACmB,0BAA0B,GAAIC,CAAC,IAAI;MACzCJ,OAAO,CAACC,GAAG,CAACG,CAAC,CAAC;IAChB,CAAC;IAED;IACA,IAAI,CAACpB,EAAE,CAACqB,cAAc,GAAG,CAAC;MAACC;IAAS,CAAC,KAAI;MACvCN,OAAO,CAACC,GAAG,CAACK,SAAS,CAAC;MACtB,IAAIA,SAAS,IAAI,IAAI,EAAE;QACrBlB,SAAS,CAACmB,IAAI,CAAC,IAAI,CAACvB,EAAE,CAACwB,gBAAgB,CAAC;;IAE5C,CAAC;IAED;IACA,IAAI,CAACxB,EAAE,CAACyB,cAAc,CAAC,OAAO,EAAE;MAACC,SAAS,EAAE;IAAU,CAAC,CAAC;IACxD,IAAI,CAAC1B,EAAE,CAACyB,cAAc,CAAC,OAAO,EAAE;MAACC,SAAS,EAAE;IAAU,CAAC,CAAC;IACxD,IAAI,CAAC1B,EAAE,CAAC2B,WAAW,EAAE,CAACC,IAAI,CAACC,CAAC,IAAI,IAAI,CAAC7B,EAAE,CAAC8B,mBAAmB,CAACD,CAAC,CAAC,CAAC,CAACE,KAAK,CAAEX,CAAC,IAAI;MAC1EJ,OAAO,CAACgB,KAAK,CAACZ,CAAC,CAAC;IAClB,CAAC,CAAC;IAEF;IACA,IAAI,CAACpB,EAAE,CAACiC,mBAAmB;MAAA,sJAAG,WAAOb,CAAC,EAAI;QACxC,IAAI;UACF,MAAM,MAAI,CAACpB,EAAE,CAAC8B,mBAAmB,EAAE;UACnC1B,SAAS,CAACmB,IAAI,CAAC,MAAI,CAACvB,EAAE,CAACwB,gBAAgB,CAAC;SACzC,CAAC,OAAOU,GAAG,EAAE;UACZlB,OAAO,CAACgB,KAAK,CAACE,GAAG,CAAC;;MAEtB,CAAC;MAAA;QAAA;MAAA;IAAA;IAED,IAAI,CAAC9B,SAAS,CAAC+B,SAAS;MAAA,uJAAC,WAAOC,CAAC,EAAI;QACnCpB,OAAO,CAACC,GAAG,CAACmB,CAAC,CAAC;QACd,IAAIA,CAAC,CAACC,IAAI,KAAK,QAAQ,EAAE;UACvBrB,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;UAE9B,IAAI;YACF;YACA,MAAM,MAAI,CAACjB,EAAE,CAACsC,oBAAoB,CAACF,CAAC,CAAC;WACtC,CAAC,OAAMhB,CAAC,EAAE;YACTJ,OAAO,CAACgB,KAAK,CAACZ,CAAC,CAAC;;;MAItB,CAAC;MAAA;QAAA;MAAA;IAAA,IAAC;EACJ;EAEamB,QAAQ;IAAA;EAErB;;AAnGWtD,YAAY;mBAAZA,YAAY;AAAA;AAAZA,YAAY;QAAZA,YAAY;EAAAuD;EAAAC;IAAA;wEACe3D,2DAAgB;;;;;;;;;;eAD3C4D,0BAAsB;MAAA;;;;;;;;MCVnCC,gEAAAA,YAAiC;;;;;;;;;;;;;;;;;;;;;;;;;ACCyB;AACF;AACT;AACiB;AACI;AACA;;AAe9D,MAAOI,SAAS;AAATA,SAAS;mBAATA,SAAS;AAAA;AAATA,SAAS;QAATA,SAAS;EAAAC,YAFR/D,wDAAY;AAAA;AAEb8D,SAAS;aAHT,CAACD,yEAAgB,CAAC;EAAAG,UAH3BL,oEAAa,EACbC,kEAAgB;AAAA;;sHAKPE,SAAS;IAAAG,eAXlBjE,wDAAY,EACZF,6EAAc,EACdC,6EAAc;IAAAiE,UAGdL,oEAAa,EACbC,kEAAgB;EAAA;AAAA;;;;;;;;;;;;;;;AChBqD;;;AAOnE,MAAO7D,cAAc;EAIzBuD,QAAQ;IACN,IAAI,CAACa,IAAI,CAACC,aAAa,CAACC,KAAK,GAAG,IAAI;EACtC;EAEOxC,SAAS,CAACpB,MAAmB;IAClC,IAAI,CAAC0D,IAAI,CAACC,aAAa,CAACE,SAAS,GAAG7D,MAAM;EAC5C;EAEOqB,IAAI;IACT,IAAI,CAACqC,IAAI,CAACC,aAAa,CAACtC,IAAI,EAAE;EAChC;EAEOyC,KAAK;IACV,IAAI,CAACJ,IAAI,CAACC,aAAa,CAACG,KAAK,EAAE;EACjC;EAEO/D,UAAU;IACf,IAAI,CAAC2D,IAAI,CAACC,aAAa,CAACC,KAAK,GAAG,CAAC,IAAI,CAACF,IAAI,CAACC,aAAa,CAACC,KAAK;IAC9DtC,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAE,IAAI,CAACmC,IAAI,CAACC,aAAa,CAACC,KAAK,CAAC;IAE5D,IAAI,CAAC,IAAI,CAACF,IAAI,CAACC,aAAa,CAACC,KAAK,EAAE;MAClC,IAAI,CAACvC,IAAI,EAAE;;EAEf;;AA3BW/B,cAAc;mBAAdA,cAAc;AAAA;AAAdA,cAAc;QAAdA,cAAc;EAAAwD;EAAAC;IAAA;wEACiBU,qDAAU;;;;;;;;;;;;MAJzCR,uDAAAA,qBAAsB;;;;;;;;;;;;;;;;;;;ACJ8B;;;AAO3D,MAAO5D,cAAc;EAIlB+B,SAAS,CAACpB,MAAmB;IAClC,IAAI,CAAC0D,IAAI,CAACC,aAAa,CAACE,SAAS,GAAG7D,MAAM;IAC1C,IAAI,CAAC0D,IAAI,CAACC,aAAa,CAACC,KAAK,GAAG,IAAI;EACtC;EAEOvC,IAAI;IACT,IAAI,CAACqC,IAAI,CAACC,aAAa,CAACtC,IAAI,EAAE;EAChC;EAEOyC,KAAK;IACV,IAAI,CAACJ,IAAI,CAACC,aAAa,CAACG,KAAK,EAAE;EACjC;EAEO/D,UAAU;IACf,IAAI,CAAC2D,IAAI,CAACC,aAAa,CAACC,KAAK,GAAG,CAAC,IAAI,CAACF,IAAI,CAACC,aAAa,CAACC,KAAK;IAC9DtC,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAE,IAAI,CAACmC,IAAI,CAACC,aAAa,CAACC,KAAK,CAAC;EAC9D;;AApBWvE,cAAc;mBAAdA,cAAc;AAAA;AAAdA,cAAc;QAAdA,cAAc;EAAAyD;EAAAC;IAAA;wEACiBU,qDAAU;;;;;;;;;;;;MAJzCR,uDAAAA,qBAAsB;;;;;;;;;;;;;;;;;;;;;ACJuC;AAEhD;;AAKpB,MAAOG,gBAAiB,SAAQW,4DAAqB;EACzDtD;IACE,MAAMwD,MAAM,GAAgC;MAC1CC,GAAG,EAAE,GAAGC,QAAQ,CAACC,MAAM,CAACC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,cAAcL,gDAAE,EAAE;KAChE;IAED,KAAK,CAACC,MAAM,CAAC;EACf;;AAPWb,gBAAiB;mBAAjBA,gBAAgB;AAAA;AAAhBA,gBAAiB;SAAjBA,gBAAgB;EAAAkB,SAAhBlB,gBAAgB;EAAAmB,YAFf;AAAM;;;;;;;;;;;;;;ACLpB;AACA;AACA;AAEO,MAAMC,WAAW,GAAG;EACzBC,UAAU,EAAE;CACb;AAED;;;;;;;AAOA;;;;;;;;;;;;;;;;ACf+C;AAGF;AACY;AAEzD,IAAID,6EAAsB,EAAE;EAC1BE,6DAAc,EAAE;;AAGlBC,sEAAAA,EAAwB,CAACC,eAAe,CAACvB,sDAAS,CAAC,CAChDhB,KAAK,CAACG,GAAG,IAAIlB,OAAO,CAACgB,KAAK,CAACE,GAAG,CAAC,CAAC","sources":["./src/app/app.component.ts","./src/app/app.component.html","./src/app/app.module.ts","./src/app/components/audio/audio.component.ts","./src/app/components/video/video.component.ts","./src/app/services/signaling.service.ts","./src/environments/environment.ts","./src/main.ts"],"sourcesContent":["import { Component, ComponentRef, HostListener, OnInit, ViewChild, ViewContainerRef } from '@angular/core';\nimport { VideoComponent } from './components/video/video.component';\nimport { AudioComponent } from './components/audio/audio.component';\nimport { SignalingService } from './services/signaling.service';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent implements OnInit {\n  @ViewChild(\"vc\", {static: true, read: ViewContainerRef }) \n  public vcr!: ViewContainerRef;\n\n  private audioList: ComponentRef<AudioComponent>[] = [];\n  private selfAudioRunning = false;\n\n  private readonly pc: RTCPeerConnection;\n\n  @HostListener('document:click', ['$event.target'])\n  async onClick(_: KeyboardEvent) {\n    if (!this.selfAudioRunning) {\n      await this.startAudio()\n    }\n  \n    for (const el of this.audioList) {\n      el.instance.toggleMute();\n    }\n  }\n\n  private async startAudio() {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n      video: false\n    });\n\n    this.pc.addTrack(stream.getAudioTracks()[0])\n\n    this.selfAudioRunning = true;\n  }\n\n  constructor(private signaling: SignalingService) {\n    //this.pc = new RTCPeerConnection({iceServers: [{urls: 'stun:stun.l.google.com:19302'}]});\n    this.pc = new RTCPeerConnection();\n\n    // Once remote track media arrives, show it in remote element.\n    this.pc.ontrack = (event) => {\n      const [remoteStream] = event.streams;\n      if (event.track.kind === 'video') {\n        const video = this.vcr.createComponent(VideoComponent, {});\n        video.instance.setStream(remoteStream);\n        video.instance.play();\n        console.log(video);\n      } else if (event.track.kind === 'audio') {\n        const audio = this.vcr.createComponent(AudioComponent, {});\n        audio.instance.setStream(remoteStream);\n        console.log(audio);\n\n        this.audioList.push(audio)\n      }\n    }\n\n    this.pc.oniceconnectionstatechange = (e) => {\n      console.log(e);\n    };\n\n    // Send any ice candidates to the other peer.\n    this.pc.onicecandidate = ({candidate}) => {\n      console.log(candidate);\n      if (candidate == null) {\n        signaling.next(this.pc.localDescription)\n      }\n    };\n\n    // Offer to receive 1 audio, and 1 video track\n    this.pc.addTransceiver('audio', {direction: 'sendrecv'})\n    this.pc.addTransceiver('video', {direction: 'recvonly'})\n    this.pc.createOffer().then(d => this.pc.setLocalDescription(d)).catch((e) => {\n      console.error(e);\n    });\n    \n    // Let the \"negotiationneeded\" event trigger offer generation.\n    this.pc.onnegotiationneeded = async (e) => {\n      try {\n        await this.pc.setLocalDescription();\n        signaling.next(this.pc.localDescription);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    this.signaling.subscribe(async (x) => {\n      console.log(x);\n      if (x.type === 'answer') {\n        console.log('Received answer');\n\n        try {\n          // the answer\n          await this.pc.setRemoteDescription(x);\n        } catch(e) {\n          console.error(e);\n        }\n\n      }\n    });\n  }\n\n  public async ngOnInit(): Promise<void> {\n    \n  }\n\n}\n","<ng-container #vc></ng-container>","import { NgModule } from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { HttpClientModule } from '@angular/common/http';\nimport { AppComponent } from './app.component';\nimport { SignalingService } from './services/signaling.service';\nimport { VideoComponent } from './components/video/video.component';\nimport { AudioComponent } from './components/audio/audio.component';\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    VideoComponent,\n    AudioComponent\n  ],\n  imports: [\n    BrowserModule,\n    HttpClientModule,\n  ],\n  providers: [SignalingService],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\n\n@Component({\n  selector: 'app-audio',\n  template: '<audio #audio></audio>',\n  styleUrls: ['./audio.component.scss']\n})\nexport class AudioComponent implements OnInit {\n  @ViewChild('audio', { static: true, read: ElementRef })\n  public elem!: ElementRef<HTMLAudioElement>;\n\n  ngOnInit(): void {\n    this.elem.nativeElement.muted = true;\n  }\n\n  public setStream(stream: MediaStream): void {\n    this.elem.nativeElement.srcObject = stream;\n  }\n\n  public play(): void {\n    this.elem.nativeElement.play()\n  }\n\n  public pause(): void {\n    this.elem.nativeElement.pause()\n  }\n\n  public toggleMute(): void {\n    this.elem.nativeElement.muted = !this.elem.nativeElement.muted;\n    console.log('toggle mute to', this.elem.nativeElement.muted);\n\n    if (!this.elem.nativeElement.muted) {\n      this.play();\n    }\n  }\n}\n","import { Component, ElementRef, ViewChild } from '@angular/core';\n\n@Component({\n  selector: 'app-video',\n  template: '<video #video></video>',\n  styleUrls: ['./video.component.scss']\n})\nexport class VideoComponent {\n  @ViewChild('video', { static: true, read: ElementRef })\n  public elem!: ElementRef<HTMLVideoElement>;\n\n  public setStream(stream: MediaStream): void {\n    this.elem.nativeElement.srcObject = stream;\n    this.elem.nativeElement.muted = true;\n  }\n\n  public play(): void {\n    this.elem.nativeElement.play()\n  }\n\n  public pause(): void {\n    this.elem.nativeElement.pause()\n  }\n\n  public toggleMute(): void {\n    this.elem.nativeElement.muted = !this.elem.nativeElement.muted;\n    console.log('toggle mute to', this.elem.nativeElement.muted);\n  }\n}\n","import { WebSocketSubject, WebSocketSubjectConfig } from 'rxjs/webSocket';\nimport { Injectable } from '@angular/core';\nimport { v4 } from 'uuid';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SignalingService extends WebSocketSubject<any> {\n  constructor() {\n    const config: WebSocketSubjectConfig<any> = {\n      url: `${location.origin.replace(\"http\", \"ws\")}/signaling/${v4()}`,\n    };\n\n    super(config);\n  }\n}\n","// This file can be replaced during build by using the `fileReplacements` array.\n// `ng build` replaces `environment.ts` with `environment.prod.ts`.\n// The list of file replacements can be found in `angular.json`.\n\nexport const environment = {\n  production: false\n};\n\n/*\n * For easier debugging in development mode, you can import the following file\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\n *\n * This import should be commented out in production mode because it will have a negative impact\n * on performance if an error is thrown.\n */\n// import 'zone.js/plugins/zone-error';  // Included with Angular CLI.\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err));\n"],"names":["ViewContainerRef","VideoComponent","AudioComponent","AppComponent","onClick","_","selfAudioRunning","startAudio","el","audioList","instance","toggleMute","stream","navigator","mediaDevices","getUserMedia","audio","video","pc","addTrack","getAudioTracks","constructor","signaling","RTCPeerConnection","ontrack","event","remoteStream","streams","track","kind","vcr","createComponent","setStream","play","console","log","push","oniceconnectionstatechange","e","onicecandidate","candidate","next","localDescription","addTransceiver","direction","createOffer","then","d","setLocalDescription","catch","error","onnegotiationneeded","err","subscribe","x","type","setRemoteDescription","ngOnInit","selectors","viewQuery","ctx","i0","BrowserModule","HttpClientModule","SignalingService","AppModule","bootstrap","imports","declarations","ElementRef","elem","nativeElement","muted","srcObject","pause","WebSocketSubject","v4","config","url","location","origin","replace","factory","providedIn","environment","production","enableProdMode","__NgCli_bootstrap_1","bootstrapModule"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}